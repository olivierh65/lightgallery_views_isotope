{# templates/views-view-style--album-justified-gallery.html.twig #}
{# This template is used to render a justified gallery of album items. #}

{# {{ dump() }} #}

{% set rows = rows|default([]) %}

{# Ensure that the rows variable is an array #}
{% if not rows is iterable %}
	{% set rows = [] %}
{% endif %}

<div{{attributes.addClass(classes)}}>
	<div id="albums-gallery"> {% for item in rows %}
		<div class="album-block">
			{% if item.medias is not empty %}
				<a href="#" class="album-cover" data-album-id="{{ item.id }}" style="display: block;">
					<span class="album-cover-title-top" style="
													position: absolute;
													top: 0;
													left: 0;
													width: 100%;
													background: rgba(0,0,0,0.4);
													color: #fff;
													padding: 0.3em 0.5em;
													font-size: 0.8em;
													font-weight: lighter;
													text-align: center;
													z-index: 2;
													border-top-left-radius: 0.3em;
													border-top-right-radius: 0.3em;
													box-sizing: border-box;
													display: block;
													">{{ item.title }}</span>
					<img src="{{ item.image_url }}" alt="{{ item.alt }}" class="album-cover-img" loading="lazy" style="display: block;">
				</a>
			{% else %}
				<span class="album-cover album-cover--disabled" style="opacity: 0.5; cursor: not-allowed; position: relative;" title="Aucun média dans cet album – {{ item.title }}">
					<img src="{{ item.image_url }}" alt="{{ item.title }}" class="album-cover-img" loading="lazy">
					<span class="album-cover-title-overlay" style="
																		position: absolute;
																		top: 50%; left: 50%;
																		transform: translate(-50%, -50%);
																		background: rgba(0,0,0,0.7);
																		color: #fff;
																		padding: 0.5em 1em;
																		text-align: center;
																		width: 30%;
																		font-weight: bold;
																		font-size: 1.1em;
																		pointer-events: none;
																		border-radius: 0.3em;
																		">{{ item.title }}</span>
				</span>
			{% endif %}
			<div id="{{ item.id }}" class="lightgallery-album" style="display:none;">
				{% for media in item.medias %}
					{% if media.mime_type starts with 'image/' %}
						<a href="{{ media.url }}" class="lightgallery__item" data-sub-html=".lightgallery_caption">
							<img loading="lazy" src="{{ media.thumbnail }}">
							<div class="lightgallery_caption">
								<h4>{{ media.title|default('') }}</h4>
								{% if media.alt %}
									<p>{{ media.alt }}</p>
								{% endif %}
								{% if media.description %}
									<p>{{ media.description }}</p>
								{% endif %}
							</div>
						</a>
					{% elseif media.mime_type starts with 'video/' %}
						<a class="lightgallery__item" data-sub-html=".lightgallery_caption" data-poster="{{ media.thumbnail|default('') }}" data-video='{"source": [{"src":"{{ media.url }}","type":"{{ media.mime_type }}"}], "attributes": {"preload": false, "playsinline": true, "controls": true}}' title="{{ media.title|default('') }}">
							{% if media.thumbnail %}
								<img loading="lazy" class="img-responsive" src="{{ media.thumbnail|default('') }}"/>
							{% endif %}
							<div class="lightgallery_caption">
								<h4>{{ media.title|default('') }}</h4>
								{% if media.alt %}
									<p>{{ media.alt }}</p>
								{% endif %}
								{% if media.description %}
									<p>{{ media.description }}</p>
								{% endif %}
							</div>
						</a>
					{% endif %}
				{% endfor %}
			</div>
			<div class="caption">
				<h3>{{ item.title }}</h3>
				{% if item.author %}
					<div class="author">{{ item.author }}</div>
				{% endif %}
				{% if item.description %}
					<p>{{ item.description }}</p>
				{% endif %}
			</div>
		</div>
	{% endfor %}
</div>
